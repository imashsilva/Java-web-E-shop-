<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin Dashboard - Smart Tech</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="CSS/admin-dashcss.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
    </head>
    <body>
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-brand">
                <h4 class="mb-0">
                    <i class="fas fa-crown me-2"></i>
                    Smart Tech Admin
                </h4>
            </div>

            <nav class="sidebar-nav">
                <a href="admin-dashboard.html" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>Dashboard
                </a>
                <a href="admin-products.html" class="nav-link">
                    <i class="fas fa-box"></i>Products
                </a>
                <a href="admin-categories.html" class="nav-link">
                    <i class="fas fa-tags"></i>Categories
                </a>
                <a href="admin-orders.html" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>Orders
                </a>
                <a href="admin-users.html" class="nav-link">
                    <i class="fas fa-users"></i>Users
                </a>
                <a href="admin-reports.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i>Reports
                </a>
                <div class="mt-4 pt-3 border-top">
                    <a href="javascript:void(0)" class="nav-link text-danger" id="adminLogout">
                        <i class="fas fa-sign-out-alt"></i>Logout
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header d-flex justify-content-between align-items-center">
                <h3 class="mb-0">Dashboard Overview</h3>
                <div class="d-flex align-items-center">
                    <span class="me-3" id="adminWelcome">Welcome, Admin</span>
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-cog"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" id="logoutBtn">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card orders">
                        <div class="stat-icon text-success">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-number text-success" id="totalOrders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card revenue">
                        <div class="stat-icon text-primary">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-number text-primary" id="totalRevenue">$0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card products">
                        <div class="stat-icon text-warning">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-number text-warning" id="totalProducts">0</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card users">
                        <div class="stat-icon text-danger">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-number text-danger" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Recent Orders -->
                <div class="col-lg-8 mb-4">
                    <div class="activity-card">
                        <h5 class="mb-4">Recent Orders</h5>
                        <div id="recentOrders">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading orders...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Low Stock Alerts & Quick Actions -->
                <div class="col-lg-4">
                    <!-- Low Stock Alerts -->
                    <div class="activity-card mb-4">
                        <h5 class="mb-4">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            Low Stock Alerts
                        </h5>
                        <div id="lowStockAlerts">
                            <div class="text-center py-3">
                                <p class="text-muted">No low stock alerts</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="activity-card">
                        <h5 class="mb-4">Quick Actions</h5>
                        <div class="d-grid gap-2">
                            <a href="admin-products.html?action=add" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Add New Product
                            </a>
                            <a href="admin-categories.html" class="btn btn-outline-primary">
                                <i class="fas fa-tags me-2"></i>Manage Categories
                            </a>
                            <a href="admin-reports.html" class="btn btn-outline-success">
                                <i class="fas fa-chart-bar me-2"></i>View Reports
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            function loadDashboardData() {
                // Load comprehensive statistics
                $.get('admin-dashboard?action=stats', function (stats) {
                    $('#totalOrders').text(stats.totalOrders || '0');
                    $('#totalRevenue').text('$' + (stats.totalRevenue || '0'));
                    $('#totalProducts').text(stats.totalProducts || '0');
                    $('#totalUsers').text(stats.totalUsers || '0');

                    // Update today's stats if you have elements for them
                    if ($('#todayOrders').length) {
                        $('#todayOrders').text(stats.todayOrders || '0');
                        $('#todayRevenue').text('$' + (stats.todayRevenue || '0'));
                        $('#todayUsers').text(stats.todayUsers || '0');
                    }

                    // Show alert badges if you have low stock
                    if (stats.lowStockCount > 0) {
                        $('#lowStockBadge').text(stats.lowStockCount).show();
                    }
                }).fail(function () {
                    console.error('Failed to load dashboard statistics');
                });

                // Load recent orders
                $.get('admin-dashboard?action=recent-orders', function (orders) {
                    let ordersHtml = '';
                    if (orders && orders.length > 0) {
                        orders.forEach(order => {
                            const statusClass = getStatusClass(order.status);
                            ordersHtml += `
                        <div class="activity-item">
                            <div class="activity-icon ${statusClass}">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong class="d-block">Order #${order.id}</strong>
                                        <small class="text-muted">${order.customerName} • ${order.date}</small>
                                    </div>
                                    <div class="text-end">
                                        <div class="text-success fw-bold">$${order.total}</div>
                                        <span class="badge bg-${statusClass}">${order.status}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                        });
                    } else {
                        ordersHtml = '<div class="text-center py-3"><p class="text-muted">No recent orders</p></div>';
                    }
                    $('#recentOrders').html(ordersHtml);
                });

                // Load low stock alerts
                $.get('admin-dashboard?action=low-stock', function (products) {
                    let alertsHtml = '';
                    if (products && products.length > 0) {
                        products.forEach(product => {
                            const stockLevel = product.stock <= 0 ? 'Out of Stock' : `Low: ${product.stock}`;
                            const badgeClass = product.stock <= 0 ? 'danger' : 'warning';

                            alertsHtml += `
                        <div class="alert-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong class="d-block">${product.name}</strong>
                                    <small class="text-muted">Stock: ${product.stock} • $${product.price}</small>
                                </div>
                                <span class="badge stock-badge bg-${badgeClass}">${stockLevel}</span>
                            </div>
                        </div>
                    `;
                        });
                    } else {
                        alertsHtml = '<div class="text-center py-2"><p class="text-muted">No low stock alerts</p></div>';
                    }
                    $('#lowStockAlerts').html(alertsHtml);
                });
            }

            function getStatusClass(status) {
                switch (status) {
                    case 'COMPLETED':
                        return 'success';
                    case 'PENDING':
                        return 'warning';
                    case 'PROCESSING':
                        return 'info';
                    case 'CANCELLED':
                        return 'danger';
                    default:
                        return 'secondary';
                }
            }
             $(document).ready(function() {
            checkAdminAuth();
            loadDashboardData();
        });

        function checkAdminAuth() {
            $.get('admin-auth?action=check', function(response) {
                if (!response.isAdmin) {
                    window.location.href = 'admin-login.html';
                } else {
                    $('#adminWelcome').text('Welcome, ' + (response.username || 'Admin'));
                }
            }).fail(function() {
                window.location.href = 'admin-login.html';
            });
        }

        function loadDashboardData() {
            // Load statistics
            $.get('admin-dashboard?action=stats', function(stats) {
                $('#totalOrders').text(stats.totalOrders || '0');
                $('#totalRevenue').text('$' + (stats.totalRevenue || '0'));
                $('#totalProducts').text(stats.totalProducts || '0');
                $('#totalUsers').text(stats.totalUsers || '0');
            });

            // Load recent orders
            $.get('admin-dashboard?action=recent-orders', function(orders) {
                let ordersHtml = '';
                if (orders && orders.length > 0) {
                    orders.forEach(order => {
                        ordersHtml += `
                            <div class="activity-item">
                                <div class="activity-icon success">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between">
                                        <strong>Order #${order.id}</strong>
                                        <span class="text-success">$${order.total}</span>
                                    </div>
                                    <small class="text-muted">${order.customerName} • ${order.date}</small>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    ordersHtml = '<div class="text-center py-3"><p class="text-muted">No recent orders</p></div>';
                }
                $('#recentOrders').html(ordersHtml);
            });

            // Load low stock alerts
            $.get('admin-dashboard?action=low-stock', function(products) {
                let alertsHtml = '';
                if (products && products.length > 0) {
                    products.forEach(product => {
                        alertsHtml += `
                            <div class="alert-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong class="d-block">${product.name}</strong>
                                        <small class="text-muted">Stock: ${product.stock}</small>
                                    </div>
                                    <span class="badge stock-badge bg-warning">Low</span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    alertsHtml = '<div class="text-center py-2"><p class="text-muted">No low stock alerts</p></div>';
                }
                $('#lowStockAlerts').html(alertsHtml);
            });
        }

        // Logout functionality
        $('#logoutBtn, #adminLogout').click(function() {
            $.post('logout', function() {
                window.location.href = 'admin-login.html';
            });
        });
        </script>

    </body>
</html>